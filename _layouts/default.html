<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'en' }}">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Primary Meta Tags -->
  <title>{% if page.title %}{{ page.title | escape }} - {{ site.title | escape }}{% else %}{{ site.title | escape }}{% endif %}</title>
  <meta name="title" content="{% if page.title %}{{ page.title | escape }} - {{ site.title | escape }}{% else %}{{ site.title | escape }}{% endif %}">
  <meta name="description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">
  <meta name="author" content="{{ page.author | default: site.author.name | escape }}">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="{% if page.layout == 'post' %}article{% else %}website{% endif %}">
  <meta property="og:url" content="{{ page.url | absolute_url }}">
  <meta property="og:title" content="{% if page.title %}{{ page.title | escape }} - {{ site.title | escape }}{% else %}{{ site.title | escape }}{% endif %}">
  <meta property="og:description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">
  <meta property="og:image" content="{{ page.image | default: '/assets/images/og-image.jpg' | absolute_url }}">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="{{ page.url | absolute_url }}">
  <meta property="twitter:title" content="{% if page.title %}{{ page.title | escape }} - {{ site.title | escape }}{% else %}{{ site.title | escape }}{% endif %}">
  <meta property="twitter:description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">
  <meta property="twitter:image" content="{{ page.image | default: '/assets/images/og-image.jpg' | absolute_url }}">
  {% if site.twitter_username %}<meta name="twitter:creator" content="@{{ site.twitter_username }}">{% endif %}

  <!-- Canonical URL -->
  <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">

  <!-- Stylesheets -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">

  <!-- Favicons -->
  <link rel="icon" type="image/x-icon" href="{{ '/assets/images/favicon.ico' | relative_url }}">
  <link rel="apple-touch-icon" sizes="180x180" href="{{ '/assets/images/apple-touch-icon.png' | relative_url }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ '/assets/images/favicon-32x32.png' | relative_url }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ '/assets/images/favicon-16x16.png' | relative_url }}">
  <link rel="manifest" href="{{ '/assets/images/site.webmanifest' | relative_url }}">

  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="{{ site.title | escape }}" href="{{ '/feed.xml' | relative_url }}">

  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "{% if page.layout == 'post' %}BlogPosting{% else %}WebSite{% endif %}",
    "url": "{{ page.url | absolute_url }}",
    "name": "{% if page.title %}{{ page.title | escape }}{% else %}{{ site.title | escape }}{% endif %}",
    "description": "{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}",
    "author": {
      "@type": "Person",
      "name": "{{ page.author | default: site.author.name | escape }}"
    },
    {% if page.layout == 'post' %}
    "headline": "{{ page.title | escape }}",
    "datePublished": "{{ page.date | date_to_xmlschema }}",
    "dateModified": "{{ page.modified_date | default: page.date | date_to_xmlschema }}",
    "image": "{{ page.image | default: '/assets/images/og-image.jpg' | absolute_url }}",
    {% endif %}
    "publisher": {
      "@type": "Person",
      "name": "{{ site.author.name | escape }}",
      "logo": {
        "@type": "ImageObject",
        "url": "{{ '/assets/images/logo.png' | absolute_url }}"
      }
    }
  }
  </script>

  <!-- SEO Plugin -->
  {% seo %}

  <!-- Google Analytics -->
  {% if site.google_analytics %}
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '{{ site.google_analytics }}');
  </script>
  {% endif %}
</head>

<body class="{% if page.layout %}{{ page.layout }}{% endif %}">
  <a href="#main-content" class="sr-only">Skip to main content</a>
  
  <header class="site-header">
    <div class="container">
      <div class="header-content">
        <a class="site-title" href="{{ '/' | relative_url }}">
          {{ site.title | escape }}
        </a>
        
        <nav class="site-nav" id="site-nav">
          <a class="nav-link {% if page.url == '/' %}active{% endif %}" href="{{ '/' | relative_url }}">Home</a>
          <a class="nav-link {% if page.url contains '/about' %}active{% endif %}" href="{{ '/about/' | relative_url }}">About</a>
          
          <div class="dropdown">
            <a class="nav-link dropdown-toggle {% if page.url contains '/innovation_tales' %}active{% endif %}" href="{{ '/innovation_tales/' | relative_url }}">Innovation Tales</a>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="{{ '/innovation_tales/urban-intelligence/' | relative_url }}">Urban Intelligence</a>
              <a class="dropdown-item" href="{{ '/innovation_tales/gaming/' | relative_url }}">Gaming</a>
              <a class="dropdown-item" href="{{ '/innovation_tales/space-exploration/' | relative_url }}">Space Exploration</a>
            </div>
          </div>
          
          <a class="nav-link {% if page.url contains '/archive' %}active{% endif %}" href="{{ '/archive/' | relative_url }}">Archive</a>
          <a class="nav-link {% if page.url contains '/contact' %}active{% endif %}" href="{{ '/contact/' | relative_url }}">Contact</a>
        </nav>
        
        <button class="mobile-menu-toggle" aria-label="Toggle mobile menu" onclick="toggleMobileMenu()">
          â˜°
        </button>
      </div>
    </div>
  </header>

  <main class="main-content" id="main-content">
    <div class="container">
      {{ content }}
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>About</h3>
          <p>{{ site.description | escape }}</p>
          <div class="social-links">
            {% if site.github_username %}
            <a href="https://github.com/{{ site.github_username }}" aria-label="GitHub">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 0C5.374 0 0 5.373 0 12 0 17.302 3.438 21.8 8.207 23.387c.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
              </svg>
            </a>
            {% endif %}
            {% if site.twitter_username %}
            <a href="https://twitter.com/{{ site.twitter_username }}" aria-label="Twitter">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
              </svg>
            </a>
            {% endif %}
            {% if site.linkedin_username %}
            <a href="https://linkedin.com/in/{{ site.linkedin_username }}" aria-label="LinkedIn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
              </svg>
            </a>
            {% endif %}
          </div>
        </div>
        
        <div class="footer-section">
          <h3>Categories</h3>
          <ul>
            <li><a href="{{ '/innovation_tales/urban-intelligence/' | relative_url }}">Urban Intelligence</a></li>
            <li><a href="{{ '/innovation_tales/gaming/' | relative_url }}">Gaming</a></li>
            <li><a href="{{ '/innovation_tales/space-exploration/' | relative_url }}">Space Exploration</a></li>
          </ul>
        </div>
        
        <div class="footer-section">
          <h3>Quick Links</h3>
          <ul>
            <li><a href="{{ '/about/' | relative_url }}">About Me</a></li>
            <li><a href="{{ '/archive/' | relative_url }}">All Posts</a></li>
            <li><a href="{{ '/contact/' | relative_url }}">Contact</a></li>
            <li><a href="{{ '/feed.xml' | relative_url }}">RSS Feed</a></li>
          </ul>
        </div>
        
        <div class="footer-section">
          <h3>Newsletter</h3>
          <p>Subscribe to get notified about new posts and insights.</p>
          <form class="newsletter-form" action="#" method="post">
            <input type="email" placeholder="Enter your email" required>
            <button type="submit" class="btn">Subscribe</button>
          </form>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>&copy; {{ site.time | date: '%Y' }} {{ site.title | escape }}. All rights reserved.</p>
        <p>Built with Jekyll and hosted on GitHub Pages.</p>
      </div>
    </div>
  </footer>

  <!-- JavaScript -->
  <script>
    // Mobile menu toggle
    function toggleMobileMenu() {
      const nav = document.getElementById('site-nav');
      nav.classList.toggle('open');
    }

    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

    // Reading progress indicator
    function updateReadingProgress() {
      const article = document.querySelector('.post-content');
      if (!article) return;
      
      const articleHeight = article.offsetHeight;
      const windowHeight = window.innerHeight;
      const scrolled = window.scrollY;
      const articleTop = article.offsetTop;
      
      const progress = Math.min(
        Math.max((scrolled - articleTop + windowHeight / 2) / articleHeight, 0),
        1
      );
      
      document.documentElement.style.setProperty('--reading-progress', progress);
    }

    // Add reading progress bar
    if (document.querySelector('.post-content')) {
      const progressBar = document.createElement('div');
      progressBar.className = 'reading-progress';
      progressBar.innerHTML = '<div class="reading-progress-bar"></div>';
      document.body.appendChild(progressBar);
      
      window.addEventListener('scroll', updateReadingProgress);
      updateReadingProgress();
    }

    // Table of contents generation
    function generateTOC() {
      const content = document.querySelector('.post-content');
      if (!content) return;
      
      const headings = content.querySelectorAll('h2, h3, h4');
      if (headings.length < 3) return;
      
      const toc = document.createElement('div');
      toc.className = 'table-of-contents';
      toc.innerHTML = '<h3>Table of Contents</h3><ul></ul>';
      
      const list = toc.querySelector('ul');
      
      headings.forEach((heading, index) => {
        const id = `heading-${index}`;
        heading.id = id;
        
        const li = document.createElement('li');
        li.className = `toc-${heading.tagName.toLowerCase()}`;
        li.innerHTML = `<a href="#${id}">${heading.textContent}</a>`;
        list.appendChild(li);
      });
      
      content.insertBefore(toc, content.firstChild);
    }

    // Initialize TOC for posts
    if (document.querySelector('.post')) {
      generateTOC();
    }

    // Copy code button
    function addCopyButtons() {
      const codeBlocks = document.querySelectorAll('pre code');
      
      codeBlocks.forEach(code => {
        const button = document.createElement('button');
        button.className = 'copy-code-btn';
        button.textContent = 'Copy';
        button.setAttribute('aria-label', 'Copy code to clipboard');
        
        button.addEventListener('click', () => {
          navigator.clipboard.writeText(code.textContent).then(() => {
            button.textContent = 'Copied!';
            setTimeout(() => {
              button.textContent = 'Copy';
            }, 2000);
          });
        });
        
        code.parentElement.style.position = 'relative';
        code.parentElement.appendChild(button);
      });
    }

    // Initialize copy buttons
    addCopyButtons();

    // Dark mode toggle (if you want to implement this later)
    function initDarkMode() {
      const darkModeToggle = document.querySelector('.dark-mode-toggle');
      if (!darkModeToggle) return;
      
      const isDark = localStorage.getItem('darkMode') === 'true';
      if (isDark) {
        document.documentElement.classList.add('dark-mode');
      }
      
      darkModeToggle.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', 
          document.documentElement.classList.contains('dark-mode')
        );
      });
    }

    // Search functionality (basic implementation)
    function initSearch() {
      const searchInput = document.querySelector('.search-input');
      const searchResults = document.querySelector('.search-results');
      
      if (!searchInput || !searchResults) return;
      
      let posts = [];
      
      // Fetch posts data (you'll need to create a search.json file)
      fetch('/search.json')
        .then(response => response.json())
        .then(data => {
          posts = data;
        })
        .catch(error => console.error('Search data not available:', error));
      
      searchInput.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase().trim();
        
        if (query.length < 2) {
          searchResults.innerHTML = '';
          searchResults.style.display = 'none';
          return;
        }
        
        const results = posts.filter(post => 
          post.title.toLowerCase().includes(query) ||
          post.content.toLowerCase().includes(query) ||
          post.categories.some(cat => cat.toLowerCase().includes(query))
        ).slice(0, 5);
        
        if (results.length > 0) {
          searchResults.innerHTML = results.map(post => 
            `<a href="${post.url}" class="search-result-item">
              <h4>${post.title}</h4>
              <p>${post.excerpt}</p>
            </a>`
          ).join('');
          searchResults.style.display = 'block';
        } else {
          searchResults.innerHTML = '<p class="no-results">No results found</p>';
          searchResults.style.display = 'block';
        }
      });
      
      // Hide results when clicking outside
      document.addEventListener('click', (e) => {
        if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
          searchResults.style.display = 'none';
        }
      });
    }

    // Initialize all features
    document.addEventListener('DOMContentLoaded', () => {
      initDarkMode();
      initSearch();
    });
  </script>

  <!-- Additional CSS for new features -->
  <style>
    .social-links {
      display: flex;
      gap: var(--space-md);
      margin-top: var(--space-lg);
    }
    
    .social-links a {
      color: var(--text-secondary);
      transition: color var(--transition-fast);
    }
    
    .social-links a:hover {
      color: var(--primary-color);
    }
    
    .newsletter-form {
      display: flex;
      gap: var(--space-sm);
      margin-top: var(--space-lg);
    }
    
    .newsletter-form input {
      flex: 1;
      padding: var(--space-sm) var(--space-md);
      border: 1px solid var(--border);
      border-radius: var(--border-radius);
      font-size: 0.9rem;
    }
    
    .newsletter-form .btn {
      padding: var(--space-sm) var(--space-md);
      font-size: 0.9rem;
    }
    
    .reading-progress {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: rgba(37, 99, 235, 0.1);
      z-index: 1000;
    }
    
    .reading-progress-bar {
      height: 100%;
      background: var(--primary-color);
      width: calc(var(--reading-progress, 0) * 100%);
      transition: width 0.1s ease;
    }
    
    .table-of-contents {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--border-radius);
      padding: var(--space-lg);
      margin: var(--space-xl) 0;
    }
    
    .table-of-contents ul {
      list-style: none;
      padding: 0;
      margin: var(--space-md) 0 0 0;
    }
    
    .table-of-contents li {
      margin: var(--space-sm) 0;
    }
    
    .table-of-contents .toc-h3 {
      margin-left: var(--space-md);
    }
    
    .table-of-contents .toc-h4 {
      margin-left: var(--space-lg);
    }
    
    .copy-code-btn {
      position: absolute;
      top: var(--space-sm);
      right: var(--space-sm);
      background: var(--primary-color);
      color: white;
      border: none;
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--border-radius);
      font-size: 0.75rem;
      cursor: pointer;
      opacity: 0;
      transition: opacity var(--transition-fast);
    }
    
    pre:hover .copy-code-btn {
      opacity: 1;
    }
    
    @media (max-width: 768px) {
      .newsletter-form {
        flex-direction: column;
      }
      
      .social-links {
        justify-content: center;
      }
    }
  </style>
</body>
</html>
